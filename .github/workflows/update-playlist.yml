name: Update Merged Playlist

on:
  schedule:
    - cron: '0 3 * * *'  # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 UTC (6 —É—Ç—Ä–∞ –ú–°–ö)
  workflow_dispatch:  # –î–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
  push:  # –ü—Ä–∏ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

jobs:
  build:
    runs-on: ubuntu-latest
    
    # –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    permissions:
      contents: write

    steps:
    # –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - name: Checkout
      uses: actions/checkout@v4

    # –®–∞–≥ 2: –°–∫–∞—á–∏–≤–∞–µ–º –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º –ø–ª–µ–π–ª–∏—Å—Ç—ã
    - name: Merge playlists
      run: |
        echo "üöÄ –ù–∞—á–∏–Ω–∞—é –∑–∞–≥—Ä—É–∑–∫—É –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤..."
        
        echo "üì• 1. –ó–∞–≥—Ä—É–∂–∞—é loganettv..."
        wget -q -O playlist1.m3u "https://loganettv.vercel.app/all.m3u"
        
        echo "üì• 2. –ó–∞–≥—Ä—É–∂–∞—é zabava-project..."
        wget -q -O playlist2.m3u "https://raw.githubusercontent.com/CrocoUser/zabava-project/main/zabava-full.m3u"
        
        echo "üì• 3. –ó–∞–≥—Ä—É–∂–∞—é IPTVstable..."
        wget -q -O playlist3.m3u "https://smolnp.github.io/IPTVru/IPTVstable.m3u8"
        
        echo "üîó –û–±—ä–µ–¥–∏–Ω—è—é –ø–ª–µ–π–ª–∏—Å—Ç—ã..."
        
        # –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        echo "#EXTM3U" > merged.m3u
        echo "# –ù–∞–∑–≤–∞–Ω–∏–µ: –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª—è–µ–º—ã–π –ø–ª–µ–π–ª–∏—Å—Ç" >> merged.m3u
        echo "# –û–±–Ω–æ–≤–ª–µ–Ω–æ: $(date '+%Y-%m-%d %H:%M:%S') UTC" >> merged.m3u
        echo "# –ò—Å—Ç–æ—á–Ω–∏–∫–∏:" >> merged.m3u
        echo "# 1. https://loganettv.vercel.app/all.m3u" >> merged.m3u
        echo "# 2. https://raw.githubusercontent.com/CrocoUser/zabava-project/main/zabava-full.m3u" >> merged.m3u
        echo "# 3. https://smolnp.github.io/IPTVru/IPTVstable.m3u8" >> merged.m3u
        echo "#" >> merged.m3u
        
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
        cat playlist1.m3u >> merged.m3u
        echo "" >> merged.m3u
        cat playlist2.m3u >> merged.m3u
        echo "" >> merged.m3u
        cat playlist3.m3u >> merged.m3u
        
        # –°—á–∏—Ç–∞–µ–º –∫–∞–Ω–∞–ª—ã
        count1=$(grep -c "^#EXTINF" playlist1.m3u || echo "0")
        count2=$(grep -c "^#EXTINF" playlist2.m3u || echo "0")
        count3=$(grep -c "^#EXTINF" playlist3.m3u || echo "0")
        total=$((count1 + count2 + count3))
        
        echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:" >> merged.m3u
        echo "# –ü–ª–µ–π–ª–∏—Å—Ç 1: $count1 –∫–∞–Ω–∞–ª–æ–≤" >> merged.m3u
        echo "# –ü–ª–µ–π–ª–∏—Å—Ç 2: $count2 –∫–∞–Ω–∞–ª–æ–≤" >> merged.m3u
        echo "# –ü–ª–µ–π–ª–∏—Å—Ç 3: $count3 –∫–∞–Ω–∞–ª–æ–≤" >> merged.m3u
        echo "# –í—Å–µ–≥–æ –∫–∞–Ω–∞–ª–æ–≤: $total" >> merged.m3u
        
        echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –í—Å–µ–≥–æ –∫–∞–Ω–∞–ª–æ–≤: $total"

    # –®–∞–≥ 3: –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    - name: Upload to GitHub
      run: |
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        git add merged.m3u
        
        # –ö–æ–º–º–∏—Ç–∏–º
        git commit -m "ü§ñ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: $(date '+%Y-%m-%d %H:%M')" || echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        
        # –ü—É—à–∏–º
        git push
