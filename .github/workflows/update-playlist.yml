name: Update Merged Playlist

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 UTC (–≤ 6 —É—Ç—Ä–∞ –ø–æ –ú–æ—Å–∫–≤–µ, –µ—Å–ª–∏ –Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –ª–µ—Ç–Ω–µ–µ –≤—Ä–µ–º—è).
    - cron: '0 3 * * *'
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ GitHub
  push: # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (—É–¥–æ–±–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

jobs:
  update:
    runs-on: ubuntu-latest

    permissions:
      contents: write  # –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.ACCESS_TOKEN }}  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à —Ç–æ–∫–µ–Ω –¥–ª—è checkout

    - name: Download and merge playlists
      run: |
        # –°–∫–∞—á–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç
        echo "üì• –°–∫–∞—á–∏–≤–∞—é –ø–µ—Ä–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç..."
        curl -s -L "https://loganettv.vercel.app/all.m3u" -o playlist1.m3u
        
        # –°–∫–∞—á–∏–≤–∞–µ–º –≤—Ç–æ—Ä–æ–π –ø–ª–µ–π–ª–∏—Å—Ç
        echo "üì• –°–∫–∞—á–∏–≤–∞—é –≤—Ç–æ—Ä–æ–π –ø–ª–µ–π–ª–∏—Å—Ç..."
        curl -s -L "https://raw.githubusercontent.com/CrocoUser/zabava-project/refs/heads/main/zabava-full.m3u" -o playlist2.m3u
        
        # –°–∫–∞—á–∏–≤–∞–µ–º –¢–†–ï–¢–ò–ô –ø–ª–µ–π–ª–∏—Å—Ç (–Ω–æ–≤—ã–π!)
        echo "üì• –°–∫–∞—á–∏–≤–∞—é —Ç—Ä–µ—Ç–∏–π –ø–ª–µ–π–ª–∏—Å—Ç..."
        curl -s -L "https://smolnp.github.io/IPTVru/IPTVstable.m3u8" -o playlist3.m3u
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–µ –ø—É—Å—Ç—ã–µ
        echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤..."
        ls -la playlist*.m3u
        
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏—Ö –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª, –¥–æ–±–∞–≤–ª—è—è –∑–∞–≥–æ–ª–æ–≤–æ–∫
        echo "üîó –û–±—ä–µ–¥–∏–Ω—è—é –ø–ª–µ–π–ª–∏—Å—Ç—ã..."
        echo "#EXTM3U Merged Playlist - Auto Updated" > merged.m3u
        echo "# –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> merged.m3u
        echo "# –ò—Å—Ç–æ—á–Ω–∏–∫–∏:" >> merged.m3u
        echo "# 1. https://loganettv.vercel.app/all.m3u" >> merged.m3u
        echo "# 2. https://raw.githubusercontent.com/CrocoUser/zabava-project/main/zabava-full.m3u" >> merged.m3u
        echo "# 3. https://smolnp.github.io/IPTVru/IPTVstable.m3u8" >> merged.m3u
        echo "" >> merged.m3u
        
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Ç—Ä–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞
        cat playlist1.m3u playlist2.m3u playlist3.m3u >> merged.m3u
        
        # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤ (—Å—Ç—Ä–æ–∫ —Å #EXTINF)
        COUNT=$(grep -c "^#EXTINF" merged.m3u || echo "0")
        echo "‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ $COUNT –∫–∞–Ω–∞–ª–æ–≤."

    - name: Upload merged playlist to repository
      run: |
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git
        git config --global user.name "GitHub Actions Bot"
        git config --global user.email "actions@github.com"
        
        # –î–æ–±–∞–≤–ª—è–µ–º, –∫–æ–º–º–∏—Ç–∏–º –∏ –ø—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        git add merged.m3u
        git commit -m "Auto-update: merged playlist $(date -u '+%Y-%m-%d %H:%M')" || echo "No changes to commit"
        git push
